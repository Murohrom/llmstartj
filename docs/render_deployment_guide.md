# Пошаговая инструкция по деплою на Render

## Обзор

Render - это отличная альтернатива Railway для развертывания Telegram ботов. Платформа предлагает бесплатный тариф с автоматическим засыпанием для экономии ресурсов.

## Предварительные требования

### 1. Подготовка проекта
- ✅ Проект в GitHub репозитории
- ✅ Dockerfile в корне проекта
- ✅ Переменные окружения в .env.example

### 2. Необходимые токены
- **Telegram Bot Token** - от @BotFather
- **OpenRouter API Key** - от https://openrouter.ai/

## Пошаговый процесс деплоя

### Шаг 1: Создание аккаунта

1. Перейдите на [Render.com](https://render.com/)
2. Нажмите "Get Started for Free"
3. Авторизуйтесь через GitHub
4. Подтвердите email

### Шаг 2: Создание Web Service

1. В панели управления нажмите "New +"
2. Выберите "Web Service"
3. Подключите ваш GitHub репозиторий
4. Выберите репозиторий с ботом

### Шаг 3: Настройка сервиса

**Основные настройки:**
- **Name**: `anime-bot` (или любое другое)
- **Environment**: `Docker`
- **Region**: выберите ближайший к вам
- **Branch**: `main`
- **Build Command**: оставьте пустым (Docker автоматически)
- **Start Command**: оставьте пустым (Docker автоматически)

### Шаг 4: Настройка переменных окружения

В разделе "Environment Variables" добавьте:

```env
TELEGRAM_BOT_TOKEN=ваш_токен_бота
OPENROUTER_API_KEY=ваш_ключ_openrouter
OPENROUTER_MODEL=openai/gpt-3.5-turbo
MAX_RETRIES=3
RETRY_DELAY=1
CACHE_TTL=3600
LOG_LEVEL=INFO
```

### Шаг 5: Настройка масштабирования

**Для бесплатного тарифа:**
- **Instance Type**: Free
- **Auto-Deploy**: Yes
- **Health Check Path**: `/` (если есть)

### Шаг 6: Деплой

1. Нажмите "Create Web Service"
2. Дождитесь завершения сборки (5-10 минут)
3. Проверьте логи на ошибки

## Особенности Render

### Автоматическое засыпание

- Сервис засыпает после 15 минут неактивности
- Пробуждается при первом HTTP запросе
- Экономит ресурсы бесплатного тарифа

### Лимиты бесплатного тарифа

- **750 часов в месяц** - достаточно для бота
- **512MB RAM** - достаточно для Python приложения
- **0.1 CPU** - базовые ресурсы
- **Автоматическое засыпание** - экономия ресурсов

## Мониторинг

### Просмотр логов

1. В панели управления выберите ваш сервис
2. Перейдите в раздел "Logs"
3. Логи обновляются в реальном времени

### Статус сервиса

- **Live** - сервис работает
- **Sleeping** - сервис спит (нормально для бесплатного тарифа)
- **Failed** - ошибка запуска

## Troubleshooting

### Проблема: Сервис не запускается

**Решение:**
1. Проверьте логи сборки
2. Убедитесь, что Dockerfile корректен
3. Проверьте переменные окружения
4. Убедитесь, что порт настроен правильно

### Проблема: Бот не отвечает

**Решение:**
1. Проверьте, что сервис не спит
2. Убедитесь в правильности токенов
3. Проверьте логи на ошибки API
4. Убедитесь, что бот не заблокирован

### Проблема: Медленный ответ

**Решение:**
1. Это нормально для бесплатного тарифа
2. Сервис просыпается при первом запросе
3. Последующие запросы будут быстрее

## Оптимизация для Render

### 1. Настройка Dockerfile

```dockerfile
# Убедитесь, что порт настроен правильно
EXPOSE 10000

# Добавьте health check
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
  CMD python -c "import sys; sys.exit(0)"
```

### 2. Настройка портов

Render автоматически устанавливает переменную `PORT`:

```python
import os
port = int(os.getenv('PORT', 10000))
```

### 3. Оптимизация размера образа

```dockerfile
# Используйте многоэтапную сборку
FROM python:3.11-slim as builder
# ... остальная конфигурация
```

## Стоимость

- **Бесплатно** - 750 часов в месяц
- **Платно** - от $7/месяц за постоянную работу

## Преимущества Render

- ✅ Простой интерфейс
- ✅ Автоматическое засыпание
- ✅ SSL сертификаты
- ✅ CDN
- ✅ Хорошая документация

## Недостатки

- ❌ Медленное пробуждение (15-30 секунд)
- ❌ Ограниченные ресурсы на бесплатном тарифе
- ❌ Нет глобального распределения

## Заключение

Render - отличная альтернатива Railway для небольших проектов. Автоматическое засыпание делает его экономичным выбором для ботов с низкой нагрузкой.

## Полезные ссылки

- [Render Documentation](https://render.com/docs)
- [Render Pricing](https://render.com/pricing)
- [Docker Documentation](https://docs.docker.com/)
