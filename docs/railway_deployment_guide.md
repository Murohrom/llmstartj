# Пошаговая инструкция по деплою на Railway

## Обзор

Railway - это современная платформа для развертывания приложений, которая идеально подходит для нашего Telegram бота. Эта инструкция проведет вас через весь процесс деплоя.

## Предварительные требования

### 1. Подготовка проекта
- ✅ Проект должен быть в GitHub репозитории
- ✅ Должен содержать `Dockerfile`
- ✅ Должен содержать `docker-compose.yml`
- ✅ Переменные окружения должны быть в `.env.example`

### 2. Необходимые токены
- **Telegram Bot Token** - получите у @BotFather
- **OpenRouter API Key** - получите на https://openrouter.ai/

## Пошаговый процесс деплоя

### Шаг 1: Создание аккаунта на Railway

1. Перейдите на [Railway.app](https://railway.app/)
2. Нажмите "Start a New Project"
3. Выберите "Deploy from GitHub repo"
4. Авторизуйтесь через GitHub
5. Предоставьте необходимые разрешения

### Шаг 2: Подключение репозитория

1. В списке репозиториев найдите ваш проект
2. Нажмите "Deploy Now"
3. Railway автоматически обнаружит Dockerfile
4. Дождитесь завершения первоначальной сборки

### Шаг 3: Настройка переменных окружения

1. В панели управления Railway перейдите в раздел "Variables"
2. Добавьте следующие переменные:

```env
TELEGRAM_BOT_TOKEN=ваш_токен_бота_здесь
OPENROUTER_API_KEY=ваш_ключ_openrouter_здесь
OPENROUTER_MODEL=openai/gpt-3.5-turbo
MAX_RETRIES=3
RETRY_DELAY=1
CACHE_TTL=3600
LOG_LEVEL=INFO
```

3. Нажмите "Save" для каждой переменной

### Шаг 4: Настройка домена

1. В разделе "Settings" найдите "Domains"
2. Railway автоматически создаст домен вида: `your-app-name.railway.app`
3. Запишите этот домен (может понадобиться для webhook)

### Шаг 5: Настройка Telegram Webhook (опционально)

Если хотите использовать webhook вместо polling:

1. Получите URL вашего приложения из Railway
2. Установите webhook через Telegram API:
```bash
curl -X POST "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/setWebhook" \
     -H "Content-Type: application/json" \
     -d '{"url": "https://your-app-name.railway.app/webhook"}'
```

### Шаг 6: Проверка деплоя

1. В разделе "Deployments" проверьте статус последнего деплоя
2. Откройте логи для проверки запуска приложения
3. Проверьте, что бот отвечает в Telegram

## Мониторинг и управление

### Просмотр логов

1. В Railway перейдите в раздел "Deployments"
2. Выберите последний деплой
3. Нажмите "View Logs"
4. Логи обновляются в реальном времени

### Обновление приложения

1. Внесите изменения в код
2. Закоммитьте и запушьте в GitHub
3. Railway автоматически запустит новый деплой
4. Следите за статусом в панели управления

### Масштабирование

1. В разделе "Settings" найдите "Scaling"
2. Настройте количество реплик (для бесплатного тарифа - 1)
3. Настройте ресурсы (CPU/RAM)

## Troubleshooting

### Проблема: Приложение не запускается

**Решение:**
1. Проверьте логи в Railway
2. Убедитесь, что все переменные окружения установлены
3. Проверьте, что Dockerfile корректен
4. Убедитесь, что порт настроен правильно

### Проблема: Бот не отвечает

**Решение:**
1. Проверьте правильность TELEGRAM_BOT_TOKEN
2. Убедитесь, что бот не заблокирован
3. Проверьте логи на ошибки API
4. Убедитесь, что OPENROUTER_API_KEY действителен

### Проблема: Высокое потребление ресурсов

**Решение:**
1. Проверьте использование памяти в логах
2. Оптимизируйте код при необходимости
3. Рассмотрите увеличение ресурсов (платно)

## Оптимизация для Railway

### 1. Настройка Dockerfile

Убедитесь, что Dockerfile оптимизирован:

```dockerfile
# Многоэтапная сборка
FROM python:3.11-slim as builder
# ... остальная конфигурация
```

### 2. Настройка портов

Railway автоматически определяет порт из переменной `PORT`:

```python
# В вашем коде
import os
port = int(os.getenv('PORT', 8000))
```

### 3. Health Check

Добавьте health check в Dockerfile:

```dockerfile
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
  CMD python -c "import sys; sys.exit(0)"
```

## Лимиты бесплатного тарифа

- **$5 кредитов в месяц** - достаточно для небольшого бота
- **Автоматическое масштабирование** - 0 реплик при отсутствии трафика
- **SSL сертификаты** - автоматически
- **Логи** - доступны в реальном времени

## Стоимость

- **Бесплатно** - до $5 кредитов в месяц
- **Платно** - $0.000463 за vCPU-секунду, $0.0000069 за GiB-секунду

## Альтернативы

Если Railway не подходит, рассмотрите:
- **Render** - похожий функционал, 750 часов бесплатно
- **Fly.io** - глобальное распределение, 3 VM бесплатно
- **Google Cloud Run** - 2M запросов бесплатно

## Заключение

Railway предоставляет отличную платформу для развертывания Telegram ботов. Простота настройки, автоматический деплой и щедрый бесплатный тариф делают его идеальным выбором для MVP.

## Полезные ссылки

- [Railway Documentation](https://docs.railway.app/)
- [Railway Pricing](https://railway.app/pricing)
- [Telegram Bot API](https://core.telegram.org/bots/api)
- [OpenRouter API](https://openrouter.ai/docs)
